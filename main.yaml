# -*- coding: utf-8 -*-
# vim: foldmethod=marker
# vim: expandtab shiftwidth=2 softtabstop=2

---
  - name: Playbook to install my common programs and keep the computer up to date.
    hosts: all
    vars:
      common_programs:
        - python3-pip
        - tmux
        - vim
        - automake
        - git
        - texlive-full
        - boinc-client
        - cowsay
        - tree
        - nmon
      common_root_python_programs:
        - ansible
      programs_to_remove:
        - nano
        - emacs
    tasks:
    - name: Getting Variables from the secret
      include_vars: 
        file: secrets.yaml

    - name: Check for updates
      register: updatesys
      become: true
      package:
        update_cache: yes
        cache_valid_time: 3600 #1 hour, time in seconds
    - name: Install Common Programs
      become: true
      package:
        name: "{{common_programs}}"
        state: present
      notify:
      - Reboot to install
    - name: Install Common Root User Python Programs
      become: true
      pip:
        name: "{{common_root_python_programs}}"
        state: present
      notify:
      - Reboot to install
    - name: Remove Bloatware Programs
      become: true
      package:
        name: "{{programs_to_remove}}"
        state: absent
      notify:
      - Reboot to install

    - name: Upgrade all remaining packages
      register: updatesys
      become: true
      package:
        upgrade: full
      notify:
      - Reboot to install

    - name: Copy Vim's .vimrc from the git submodule to hosts
      copy:
        src: ./files/vim_configuration/.vimrc
        dest: ~/.vimrc
    - name: Copy the .vim directory from the git submodule to hosts, which contains language files
      copy:
        src: ./files/vim_configuration/.vim/
        dest: ~/.vim/

    - name: Copy Bash's .bashrc from the git submodule to hosts
      copy:
        src: ./files/bash_configuration/.bashrc
        dest: ~/.bashrc
    - name: Copy Bash's /etc/ files from the git submodule to hosts
      become: true
      copy:
        src: ./files/bash_configuration/etc/
        dest: /etc/
        owner: root
        group: root

    handlers:
      - name: Reboot to install
        become: true
        reboot:
        when: ansible_connection == "ssh"
